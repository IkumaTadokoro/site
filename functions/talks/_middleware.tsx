import React from "react";
import vercelOGPagesPlugin from "@cloudflare/pages-plugin-vercel-og";

interface Props {
  ogTitle: string;
}

export const onRequest = vercelOGPagesPlugin<Props>({
  imagePathSuffix: "/ogp.png",
  component: ({ ogTitle }) => {
    return (
      <div
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          width: "100%",
          height: "100%",
          backgroundImage: `url(${`data:image/svg+xml, ${encodeURIComponent(
            '<svg width="1200" height="630" viewBox="0 0 1200 630" fill="none" xmlns="http://www.w3.org/2000/svg"> <rect width="1200" height="630" fill="white"/> <path d="M789.155 543.984H798.275V570H789.155V543.984ZM793.715 541.104C792.051 541.104 790.707 540.64 789.683 539.712C788.659 538.784 788.147 537.632 788.147 536.256C788.147 534.88 788.659 533.728 789.683 532.8C790.707 531.872 792.051 531.408 793.715 531.408C795.379 531.408 796.723 531.856 797.747 532.752C798.771 533.616 799.283 534.736 799.283 536.112C799.283 537.552 798.771 538.752 797.747 539.712C796.723 540.64 795.379 541.104 793.715 541.104ZM816.009 560.88L813.321 563.616V570H804.201V534.384H813.321V553.056L822.633 543.984H833.433L822.633 555.12L834.345 570H823.305L816.009 560.88ZM863.999 543.984V570H855.311V567.216C854.351 568.272 853.199 569.072 851.855 569.616C850.511 570.16 849.087 570.432 847.583 570.432C844.223 570.432 841.535 569.44 839.519 567.456C837.535 565.472 836.543 562.496 836.543 558.528V543.984H845.663V557.04C845.663 558.992 846.031 560.416 846.767 561.312C847.503 562.208 848.575 562.656 849.983 562.656C851.423 562.656 852.591 562.16 853.487 561.168C854.415 560.144 854.879 558.592 854.879 556.512V543.984H863.999ZM903.761 543.552C906.961 543.552 909.505 544.512 911.393 546.432C913.313 548.352 914.273 551.248 914.273 555.12V570H905.153V556.608C905.153 554.784 904.801 553.44 904.097 552.576C903.425 551.712 902.465 551.28 901.217 551.28C899.841 551.28 898.737 551.76 897.905 552.72C897.073 553.68 896.657 555.136 896.657 557.088V570H887.537V556.608C887.537 553.056 886.225 551.28 883.601 551.28C882.193 551.28 881.073 551.76 880.241 552.72C879.409 553.68 878.993 555.136 878.993 557.088V570H869.873V543.984H878.561V546.72C879.521 545.664 880.657 544.88 881.969 544.368C883.313 543.824 884.769 543.552 886.337 543.552C888.161 543.552 889.793 543.888 891.233 544.56C892.673 545.232 893.841 546.256 894.737 547.632C895.761 546.32 897.057 545.312 898.625 544.608C900.193 543.904 901.905 543.552 903.761 543.552ZM947.909 543.984V570H939.221V567.408C937.525 569.424 934.965 570.432 931.541 570.432C929.173 570.432 927.013 569.888 925.061 568.8C923.141 567.68 921.605 566.096 920.453 564.048C919.333 562 918.773 559.632 918.773 556.944C918.773 554.256 919.333 551.904 920.453 549.888C921.605 547.84 923.141 546.272 925.061 545.184C927.013 544.096 929.173 543.552 931.541 543.552C934.613 543.552 937.029 544.448 938.789 546.24V543.984H947.909ZM933.461 563.184C935.061 563.184 936.373 562.64 937.397 561.552C938.421 560.432 938.933 558.896 938.933 556.944C938.933 555.024 938.421 553.52 937.397 552.432C936.373 551.344 935.061 550.8 933.461 550.8C931.861 550.8 930.549 551.344 929.525 552.432C928.501 553.52 927.989 555.024 927.989 556.944C927.989 558.896 928.501 560.432 929.525 561.552C930.549 562.64 931.861 563.184 933.461 563.184ZM953.156 552.816H967.172V559.824H953.156V552.816ZM989.141 568.944C988.373 569.424 987.429 569.792 986.309 570.048C985.221 570.304 984.053 570.432 982.805 570.432C979.413 570.432 976.805 569.6 974.981 567.936C973.189 566.272 972.293 563.792 972.293 560.496V538.176H981.413V544.944H987.317V551.76H981.413V560.4C981.413 561.36 981.653 562.096 982.133 562.608C982.613 563.12 983.269 563.376 984.101 563.376C985.157 563.376 986.085 563.104 986.885 562.56L989.141 568.944ZM996.948 570.432C995.412 570.432 994.116 569.92 993.06 568.896C992.004 567.872 991.476 566.576 991.476 565.008C991.476 563.408 991.988 562.112 993.012 561.12C994.068 560.128 995.38 559.632 996.948 559.632C998.548 559.632 999.86 560.128 1000.88 561.12C1001.91 562.112 1002.42 563.408 1002.42 565.008C1002.42 566.576 1001.89 567.872 1000.84 568.896C999.812 569.92 998.516 570.432 996.948 570.432Z" fill="black"/> <path d="M100.325 97.96C97.5086 96.392 94.6446 95.352 91.7326 94.84V121H82.2286V94.84C79.2526 95.352 76.3886 96.392 73.6366 97.96L70.4686 91.048C72.8046 89.64 75.3806 88.568 78.1966 87.832C81.0446 87.096 83.9726 86.728 86.9806 86.728C89.9886 86.728 92.9006 87.096 95.7166 87.832C98.5646 88.568 101.157 89.64 103.493 91.048L100.325 97.96ZM121.415 86.728C124.583 86.728 127.367 87.368 129.767 88.648C132.199 89.896 134.071 91.736 135.383 94.168C136.727 96.568 137.399 99.464 137.399 102.856V121H127.895V113.56H114.791V121H105.431V102.856C105.431 99.464 106.087 96.568 107.399 94.168C108.743 91.736 110.615 89.896 113.015 88.648C115.447 87.368 118.247 86.728 121.415 86.728ZM127.895 106.216V102.04C127.895 99.576 127.303 97.72 126.119 96.472C124.935 95.224 123.351 94.6 121.367 94.6C119.351 94.6 117.751 95.224 116.567 96.472C115.383 97.72 114.791 99.576 114.791 102.04V106.216H127.895ZM143.829 87.4H153.333V113.464H169.365V121H143.829V87.4ZM186.086 108.808L182.534 112.6V121H173.126V87.4H182.534V101.368L195.542 87.4H206.006L192.278 102.28L206.726 121H195.686L186.086 108.808Z" fill="black"/> <path d="M1044.44 539.565C1041.78 536.908 1038.39 535.098 1034.71 534.365C1031.02 533.632 1027.2 534.008 1023.73 535.446C1020.26 536.884 1017.29 539.32 1015.2 542.444C1013.11 545.569 1012 549.242 1012 553C1012 556.758 1013.11 560.431 1015.2 563.556C1017.29 566.68 1020.26 569.116 1023.73 570.554C1027.2 571.992 1031.02 572.368 1034.71 571.635C1038.39 570.902 1041.78 569.092 1044.44 566.435L1031 553L1044.44 539.565Z" fill="#15803D"/> <circle cx="1069" cy="553" r="19" fill="#FBBF24"/> <path d="M1125.27 568.297C1128.46 565.945 1130.84 562.653 1132.07 558.883C1133.29 555.113 1133.31 551.053 1132.12 547.272C1130.92 543.491 1128.57 540.179 1125.4 537.8C1122.23 535.421 1118.39 534.094 1114.43 534.005C1110.46 533.916 1106.57 535.069 1103.29 537.304C1100.02 539.538 1097.52 542.741 1096.16 546.465C1094.8 550.188 1094.63 554.245 1095.69 558.066C1096.75 561.888 1098.97 565.283 1102.06 567.776L1114 553L1125.27 568.297Z" fill="#1D4ED8"/> <rect x="20.5" y="21.5" width="1158" height="587" rx="5.5" stroke="#F9F9F9" stroke-width="3"/> </svg> '
          )}`})`,
          backgroundRepeat: "no-repeat",
          backgroundPosition: "center",
          backgroundSize: "100% 100%",
        }}
      >
        <div
          style={{
            display: "flex",
            flexWrap: "wrap",
            alignItems: "center",
            justifyContent: "flex-start",
            width: "80%",
          }}
        >
          <span
            style={{
              fontSize: "70px",
              fontWeight: "900",
              color: "white",
              backgroundColor: "black",
              padding: "8px 32px",
            }}
          >
            {ogTitle}
          </span>
        </div>
      </div>
    );
  },
  extractors: {
    on: {
      'meta[property="og:title"]': (props) => ({
        element(element) {
          props.ogTitle = element.getAttribute("content")!;
        },
      }),
    },
  },

  // NOTE: 動作しない。バグってる？
  autoInject: {
    openGraph: true,
  },
});
